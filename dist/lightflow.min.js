!function(t,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var e={exports:{}};n(e.exports),t.lightflow=e.exports}}(this,function(t){"use strict";function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){return new h(t||{})};var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),i=function(t,n,e){if(t.active){if(t.idx>=0){var i=t.stepChain[t.idx];if(++i.currentCount<i.maxCounth)return}if("string"==typeof e)for(var s=0;s<t.stepChain.length;++s)if(t.stepChain[s].taskList[0].label===e){t.idx=s;break}if(++t.idx<t.stepChain.length){var r=t.stepChain[t.idx];++t.stepId,r.stepId=t.stepId,r.currentCount=0,r.taskList.forEach(function(e){e.currentCount=0,e.maxCount=1,e.processTaskFn(t,e,n)})}else t.stop(),t.doneChain.forEach(function(t){return t.task.call(t.context,n)}),t.looped&&t.start(n)}else if(t.stopTask){var o=t.stopTask,a=o.task,u=o.context;a.call(u,n),t.stopTask=void 0}},s=function(t,n,e){i(t,e)},r=function(t,n,e){var s=n.task,r=n.context,o=t.stepId,u=function(e,s){o===t.stepId&&++n.currentCount>=n.maxCount&&i(t,e,s)},h=function(n){o===t.stepId&&a(t,n)},c=function(t){return n.maxCount=t};s.call(r,{next:u,error:h,count:c,data:e})},o=function(t,n,e){var i=n.task;i.loop(!1).start(e)},a=function(t,n){var e=t.errorChain.filter(function(n){return n.idx===t.idx}).reduce(function(t,e){var i=e.task.call(e.context,n);return void 0!==i?i:t},void 0);void 0!==e?(t.stepChain[t.idx].currentCount=t.stepChain[t.idx].maxCounth,i(t,e)):(t.stop(),t.catchChain.filter(function(n){return n.idx>=t.idx}).forEach(function(t){return t.task.call(t.context,n)}))},u=function(t,n){var e=[];return n?("string"==typeof n[0]?e.push({label:n[0],processTaskFn:s}):n.forEach(function(n){"function"==typeof n?e.push({task:n,processTaskFn:r}):n instanceof h?!function(){var s=t.stepChain.length;n.done(function(n){t.stepChain[s].stepId===t.stepId&&i(t,n)}).catch(function(n){t.stepChain[s].stepId===t.stepId&&a(t,n)}),e.push({task:n,processTaskFn:o})}():e.length&&(e[e.length-1].context=n)}),e):e},h=function(){function t(e){var i=e.nothrow;n(this,t),this.nothrow=!!i,this.stepId=0,this.idx=-1,this.active=!1,this.looped=!1,this.stepChain=[],this.doneChain=[],this.errorChain=[],this.catchChain=[]}return e(t,[{key:"then",value:function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];var i=u(this,n),s=i.length;return s&&this.stepChain.push({taskList:i,maxCount:s}),this}},{key:"race",value:function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];var i=u(this,n),s=1;return i.length&&this.stepChain.push({taskList:i,maxCount:s}),this}},{key:"error",value:function(t,n){var e=this.stepChain.length-1;return this.errorChain.push({task:t,context:n,idx:e}),this}},{key:"catch",value:function(t,n){var e=this.stepChain.length-1;return this.catchChain.push({task:t,context:n,idx:e}),this}},{key:"done",value:function(t,n){return this.doneChain.push({task:t,context:n}),this}},{key:"loop",value:function(t){return this.looped=void 0===t||t,this}},{key:"start",value:function(t){if(!this.active)return this.active=!0,this.idx=-1,i(this,t),this}},{key:"stop",value:function(t,n){return this.active&&(this.active=!1,t&&(this.stopTask={task:t,context:n})),this}}]),t}()});
//# sourceMappingURL=dist/lightflow.min.js.map