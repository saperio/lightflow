!function(t,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var e={exports:{}};n(e.exports),t.lightflow=e.exports}}(this,function(t){"use strict";function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return new s};var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),i=function(t,n){if(!t.active){var e=t.stop_fn;return void(e&&(e.task.call(e.context,n),t.stop_fn=void 0))}++t.idx<t.taskChain.length?t.taskChain[t.idx].processFn(t,n):(t.stop(),t.doneChain.forEach(function(t){return t.task.call(t.context,n)}),t.looped&&t.start())},r=function(t,n){var e=t.taskChain[t.idx];e.task instanceof s?e.task.done(function(n){return i(t,n)}).catch(function(n){return a(t,n)}).loop(!1).start(n):e.task.call(e.context,{next:function(n){return i(t,n)},error:function(n){return a(t,n)},data:n})},o=function(t,n){var e=t.taskChain[t.idx],r=[],o=e.task.map(function(){return 1});e.task.forEach(function(e,s){e.task.call(e.context,{count:function(t){return o[s]=t},next:function(n){--o[s]>=0&&r.push(n),t.active&&!o.every(function(t){return t<=0})||i(t,r)},error:function(n){return a(t,n)},data:n})})},a=function(t,n){var e=t.errorChain.filter(function(n){return n.idx===t.idx}).reduce(function(t,e){return e.task.call(e.context,n)||t},!1);e?i(t):(t.stop(),t.catchChain.filter(function(n){return n.idx>=t.idx}).forEach(function(t){return t.task.call(t.context,n)}))},s=function(){function t(){n(this,t),this.taskChain=[],this.doneChain=[],this.errorChain=[],this.catchChain=[],this.idx=-1,this.active=!1,this.looped=!1}return e(t,[{key:"then",value:function(t,n){return this.taskChain.push({task:t,context:n,processFn:r}),this}},{key:"with",value:function(){for(var t=[],n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];return e.forEach(function(n){"function"==typeof n?t.push({task:n}):t.length&&(t[t.length-1].context=n)}),this.taskChain.push({task:t,processFn:o}),this}},{key:"error",value:function(t,n){return this.errorChain.push({task:t,context:n,idx:this.taskChain.length-1}),this}},{key:"catch",value:function(t,n){return this.catchChain.push({task:t,context:n,idx:this.taskChain.length-1}),this}},{key:"done",value:function(t,n){return this.doneChain.push({task:t,context:n}),this}},{key:"loop",value:function(t){return this.looped=void 0===t||t,this}},{key:"start",value:function(t){if(!this.active)return this.active=!0,this.idx=-1,i(this,t),this}},{key:"stop",value:function(t,n){return this.active&&(this.active=!1,this.stop_fn={task:t,context:n}),this}}]),t}()});
//# sourceMappingURL=dist/lightflow.min.js.map