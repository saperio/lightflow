!function(t,n){if("function"==typeof define&&define.amd)define(["exports"],n);else if("undefined"!=typeof exports)n(exports);else{var e={exports:{}};n(e.exports),t.lightflow=e.exports}}(this,function(t){"use strict";function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return new c};var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),r=function(t){for(var n=arguments.length,e=Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];if(t.active)if(++t.idx<t.taskChain.length){var a;(a=t.taskChain[t.idx]).processFn.apply(a,[t].concat(e))}else t.stop(),t.doneChain.forEach(function(t){var n;return(n=t.task).call.apply(n,[t.context].concat(e))}),t.looped&&t.start.apply(t,e);else{var i=t.stop_fn;if(i){var o;(o=i.task).call.apply(o,[i.context].concat(e)),t.stop_fn=void 0}}},a=function(t){for(var n=t.taskChain[t.idx],e=arguments.length,a=Array(e>1?e-1:0),i=1;i<e;i++)a[i-1]=arguments[i];if(n.task instanceof c){var s;(s=n.task.done(function(){for(var n=arguments.length,e=Array(n),a=0;a<n;a++)e[a]=arguments[a];return r.apply(void 0,[t].concat(e))}).catch(function(n){return o(t,n)}).loop(!1)).start.apply(s,a)}else{var u;(u=n.task).call.apply(u,[n.context,function(){for(var n=arguments.length,e=Array(n),a=0;a<n;a++)e[a]=arguments[a];return r.apply(void 0,[t].concat(e))},function(n){return o(t,n)}].concat(a))}},i=function(t){for(var n=arguments.length,e=Array(n>1?n-1:0),a=1;a<n;a++)e[a-1]=arguments[a];var i=t.taskChain[t.idx],c=[],s=i.task.map(function(){return 1});i.task.forEach(function(n,a){var i;(i=n.task).call.apply(i,[n.context,function(t){return s[a]=t},function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];--s[a]>=0&&c.push(e),t.active&&!s.every(function(t){return t<=0})||r(t,c)},function(n){return o(t,n)}].concat(e))})},o=function(t,n){var e=t.errorChain.filter(function(n){return n.idx===t.idx}).reduce(function(t,e){return e.task.call(e.context,n)||t},!1);e?r(t):(t.stop(),t.catchChain.filter(function(n){return n.idx>=t.idx}).forEach(function(t){return t.task.call(t.context,n)}))},c=function(){function t(){n(this,t),this.taskChain=[],this.doneChain=[],this.errorChain=[],this.catchChain=[],this.idx=-1,this.active=!1,this.looped=!1}return e(t,[{key:"then",value:function(t,n){return this.taskChain.push({task:t,context:n,processFn:a}),this}},{key:"with",value:function(){for(var t=[],n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];return e.forEach(function(n){"function"==typeof n?t.push({task:n}):t.length&&(t[t.length-1].context=n)}),this.taskChain.push({task:t,processFn:i}),this}},{key:"error",value:function(t,n){return this.errorChain.push({task:t,context:n,idx:this.taskChain.length-1}),this}},{key:"catch",value:function(t,n){return this.catchChain.push({task:t,context:n,idx:this.taskChain.length-1}),this}},{key:"done",value:function(t,n){return this.doneChain.push({task:t,context:n}),this}},{key:"loop",value:function(t){return this.looped=void 0===t||t,this}},{key:"start",value:function(){if(!this.active){this.active=!0,this.idx=-1;for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return r.apply(void 0,[this].concat(n)),this}}},{key:"stop",value:function(t,n){return this.active&&(this.active=!1,this.stop_fn={task:t,context:n}),this}}]),t}()});
//# sourceMappingURL=dist/flat/lightflow.min.js.map